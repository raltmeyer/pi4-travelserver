services:
  filebrowser:
    image: filebrowser/filebrowser:latest
    container_name: filebrowser
    restart: unless-stopped
    user: "1000:1000" # Match the owner of the mounted drive
    ports:
      - "8080:80"
    volumes:
      - ${MOUNT_POINT:-/mnt/ssd}/files:/srv
      - ./filebrowser.db:/database.db
      - ./.filebrowser.json:/.filebrowser.json
    environment:
      - FB_DATABASE=/database.db
      - FB_ROOT=/srv

  samba:
    image: dperson/samba
    container_name: samba
    restart: unless-stopped
    environment:
      - TZ=${TIMEZONE:-America/Sao_Paulo}
      - USERID=1000
      - GROUPID=1000
      - SHARE=share;${MOUNT_POINT:-/mnt/ssd}/files;yes;no;no;valid_users;none;
      - WORKGROUP=WORKGROUP
    ports:
      - "137:137/udp"
      - "138:138/udp"
      - "139:139/tcp"
      - "445:445/tcp"
    volumes:
      - ${MOUNT_POINT:-/mnt/ssd}/files:/${MOUNT_POINT:-/mnt/ssd}/files
      - samba_data:/var/lib/samba
    command: '-s "share;${MOUNT_POINT:-/mnt/ssd}/files;yes;no;no;valid_users;none;"'

volumes:
  samba_data:

networks:
  default:
    driver: bridge
